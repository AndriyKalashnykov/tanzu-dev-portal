<div class="section-index">
    <div>
        <div class="px-0 mb-5 shows">
        {{ range sort .Sections }}
            <div class="row flex justify-content-between align-items-baseline mb-3" >
                <a href="{{ .RelPermalink }}"><h4>{{ .Title }}</h4></a>
                <h5 class='text-uppercase text-white'>{{ .Params.teaser }} </h5>
            </div>
            <div class='row flex justify-content-between mb-5 episodes'>
                
            {{ range first 3 (sort .RegularPages ".Date" "desc") }}
                <a class='col-4-thumbnail col-lg-4 col-12 rounded overflow-hidden mb-4 position-relative' href="{{ .RelPermalink }}">
                    <div class='thumbnail-gradient position-absolute'></div>
                    <img src="{{ .Params.episode_image | relURL }}" />
                    <div class='video-description'>{{.Title}}</div>
                    {{ printf "<div class=\"upcoming col-lg-6 col-12 px-0 mb-5\" data-episode-date=\"%s\">" (.Date.Format "2006-01-02T15:04:05-07:00") | safeHTML }}</div>
                    <span class="countdown btn btn-small mb-4 mt-2">Live&nbsp;<script>document.write(whenLive);</script></span>
                    <script>
                        var upcomingEpisodes = document.querySelectorAll('div.upcoming');
                        var upcomingEpisode = upcomingEpisodes[upcomingEpisodes.length - 1];
                        var currentDate = new Date(new Date().getFullYear(),new Date().getMonth() , new Date().getDate());
                        var epDate = (new Date(upcomingEpisode.dataset.episodeDate)).getTime();
                        var diffTime = Math.abs(epDate - currentDate);
                        var diffDays = Math.floor(diffTime / (1000 * 3600 * 24)); 
                        var whenLive = "in " + diffDays + " days";
                        if (diffDays == 0) whenLive = "today";
                        
                    </script>
                </a>
            {{ end }}
            </div>
        {{ end }}

        </div>
    </div>
</div>
